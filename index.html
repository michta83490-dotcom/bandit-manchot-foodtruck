<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üé∞ La Bo√Æte √† Nems ‚Äì Jeu</title>

<style>
  body{
    margin:0;
    font-family: Arial, sans-serif;
    background:#111;
    color:#fff;
    text-align:center;
    padding:20px;
  }
  h1{margin:10px 0 4px}
  .sub{opacity:.85;margin:0 0 14px}
  .card{
    max-width:480px;
    margin:0 auto;
    padding:20px;
    background:rgba(255,255,255,0.08);
    border-radius:16px;
    border:1px solid rgba(255,255,255,0.12);
  }
  .reels{
    display:flex;
    justify-content:center;
    gap:16px;
    font-size:64px;
    margin:18px 0 6px;
    user-select:none;
  }
  .reel{ width:92px; }
  button{
    font-size:18px;
    padding:12px 18px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-weight:bold;
    margin:6px;
  }
  button:disabled{opacity:0.55;cursor:not-allowed}
  .spin{ background:#ffd700; color:#111; }
  .site{ background:#fff; color:#111; }
  .order{ background:#2ecc71; color:#111; }
  .claim{ background:#ff5aa5; color:#111; }
  .msg{
    margin-top:12px;
    font-size:18px;
    min-height:70px;
    line-height:1.25;
  }
  .win{ color:#7CFF8A; font-weight:900; }
  .lose{ color:#FF7C7C; font-weight:900; }
  .legend{
    margin-top:14px;
    text-align:left;
    font-size:14px;
    opacity:.92;
    line-height:1.45;
  }
  .rules{
    margin-top:10px;
    font-size:12px;
    opacity:.9;
    line-height:1.45;
    text-align:left;
  }
  .chip{
    display:inline-block;
    padding:6px 10px;
    border-radius:999px;
    background:rgba(255,255,255,.10);
    border:1px solid rgba(255,255,255,.12);
    font-size:12px;
    opacity:.95;
    margin-top:8px;
  }
  .claimBox{
    display:none;
    margin-top:12px;
    padding:12px;
    border-radius:12px;
    background:rgba(0,0,0,.25);
    border:1px solid rgba(255,255,255,.12);
    text-align:center;
  }
  .code{
    font-size:34px;
    letter-spacing:3px;
    font-weight:900;
    margin:10px 0 6px;
  }
</style>
</head>

<body>
  <h1>üé∞ LA BO√éTE √Ä NEMS</h1>
  <div class="sub">Joue pour le fun‚Ä¶ et parfois un cadeau üòÑ</div>

  <div class="card">
    <div class="reels">
      <div class="reel" id="r1">üçí</div>
      <div class="reel" id="r2">‚≠êÔ∏è</div>
      <div class="reel" id="r3">7Ô∏è‚É£</div>
    </div>

    <button id="spinBtn" class="spin" onclick="spin()">SPIN</button>

    <div id="msg" class="msg"></div>
    <div id="info" class="chip" style="display:none;"></div>

    <button class="site" onclick="goSite()">D√©couvrir La Bo√Æte √† Nems</button>
    <button class="order" onclick="callNow()">Commander</button>

    <div class="legend">
      üçíüçíüçí = 1 boisson soft<br>
      ‚≠ê‚≠ê‚≠ê = 1 box ap√©ro 8 pi√®ces<br>
      7Ô∏è‚É£7Ô∏è‚É£7Ô∏è‚É£ = 1 Pad tha√Ø traditionnel nature
    </div>

    <div class="rules">
      ‚è≥ 1 tentative toutes les 30 minutes.<br>
      üí∂ Commande minimum <b>30‚Ç¨</b>.<br>
      üìÖ Gain valable <b>48h</b> √† compter du gain.<br>
      üõ°Ô∏è Si tu gagnes, tu ne peux plus rejouer pendant <b>48h</b> sur ce t√©l√©phone.<br>
      üéÅ Pour r√©cup√©rer : appuie sur <b>‚ÄúR√©clamer au camion‚Äù</b> devant nous (code valable 10 min).
    </div>

    <div id="claimBox" class="claimBox">
      <div><b>CODE DE R√âCLAMATION</b></div>
      <div id="claimCode" class="code">BN-------</div>
      <div id="claimTimer" class="chip">Valable 10 minutes</div><br>
      <div id="claimUntil" class="chip" style="display:none;"></div><br>
      <button id="claimBtn" class="claim" onclick="claimNow()">R√©clamer au camion</button>
      <div class="rules" style="text-align:center;margin-top:8px;">
        ‚ö†Ô∏è Code temporaire : une capture d‚Äô√©cran ne suffit pas.
      </div>
    </div>
  </div>

<script>
/* =========================
   REGLAGES
   ========================= */
const SITE_URL = "https://la-boite-a-nems-le-muy.eatbu.com";
const PHONE_TEL = "+33782549660";

const COOLDOWN_MINUTES = 30;
const WIN_LOCK_HOURS = 48;

const CLAIM_VALID_MIN = 10;   // code reclamation valable 10 minutes
const WIN_VALID_HOURS = 48;   // gain valable 48h

// Probas approx
const P_PAD = 5;
const P_BOX = 12.5;
const P_SOFT = 20;

const SYMBOLS = ["üçí","‚≠êÔ∏è","7Ô∏è‚É£"];

/* =========================
   DOM
   ========================= */
const r1 = document.getElementById("r1");
const r2 = document.getElementById("r2");
const r3 = document.getElementById("r3");
const msg = document.getElementById("msg");
const info = document.getElementById("info");
const btn = document.getElementById("spinBtn");

const claimBox = document.getElementById("claimBox");
const claimCodeEl = document.getElementById("claimCode");
const claimTimerEl = document.getElementById("claimTimer");
const claimUntilEl = document.getElementById("claimUntil");

/* =========================
   STOCKAGE
   ========================= */
const KEY_LASTPLAY = "lban_lastPlayTs";
const KEY_WINLOCK  = "lban_winLockUntil";
const KEY_LASTWIN  = "lban_lastWin";   // {ts, prize, untilTs}
const KEY_CLAIM    = "lban_claim";     // {code, expTs, used}

/* =========================
   UTIL
   ========================= */
function nowMs(){ return Date.now(); }

function goSite(){ window.open(SITE_URL, "_blank"); }
function callNow(){ window.open("tel:" + PHONE_TEL); }

function setMsg(html, cls){
  msg.className = "msg " + (cls || "");
  msg.innerHTML = html;
}

function showInfo(text){
  if(!text){
    info.style.display = "none";
    info.textContent = "";
    return;
  }
  info.style.display = "inline-block";
  info.textContent = text;
}

function randSymbol(){
  return SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)];
}

function fmtWait(min){
  return (min <= 1) ? "1 minute" : (min + " minutes");
}

function pad2(n){ return String(n).padStart(2,"0"); }

function fmtDateTime(ts){
  const d = new Date(ts);
  return pad2(d.getDate()) + "/" + pad2(d.getMonth()+1) + " " + pad2(d.getHours()) + ":" + pad2(d.getMinutes());
}

function getCooldown(){
  const last = localStorage.getItem(KEY_LASTPLAY);
  if(!last) return {ok:true};
  const diffMin = (nowMs() - parseInt(last,10)) / 1000 / 60;
  if(diffMin >= COOLDOWN_MINUTES) return {ok:true};
  return {ok:false, wait: Math.ceil(COOLDOWN_MINUTES - diffMin)};
}

function getWinLock(){
  const until = localStorage.getItem(KEY_WINLOCK);
  if(!until) return {ok:true};
  const left = parseInt(until,10) - nowMs();
  if(left <= 0) return {ok:true};
  return {ok:false, waitMin: Math.ceil(left/1000/60), untilTs: parseInt(until,10)};
}

function setWinLockHours(h){
  localStorage.setItem(KEY_WINLOCK, String(nowMs() + h*60*60*1000));
}

function pickOutcome(){
  const roll = Math.random()*100;
  if(roll < P_PAD) return "PAD";
  if(roll < (P_PAD + P_BOX)) return "BOX";
  if(roll < (P_PAD + P_BOX + P_SOFT)) return "SOFT";
  return "LOSE";
}

function saveLastWin(prize){
  const ts = nowMs();
  const untilTs = ts + WIN_VALID_HOURS*60*60*1000;
  localStorage.setItem(KEY_LASTWIN, JSON.stringify({ts: ts, prize: prize, untilTs: untilTs}));
}

function getLastWin(){
  const raw = localStorage.getItem(KEY_LASTWIN);
  if(!raw) return null;
  try{ return JSON.parse(raw); }catch(e){ return null; }
}

function winStillValid(){
  const w = getLastWin();
  if(!w) return false;
  return nowMs() <= w.untilTs;
}

/* =========================
   CODE RECLAMATION
   ========================= */
function makeClaimCode(){
  const n = Math.floor(100000 + Math.random()*900000);
  return "BN-" + n;
}

function createClaim(){
  const code = makeClaimCode();
  const expTs = nowMs() + CLAIM_VALID_MIN*60*1000;
  const payload = {code: code, expTs: expTs, used:false};
  localStorage.setItem(KEY_CLAIM, JSON.stringify(payload));
  return payload;
}

function getClaim(){
  const raw = localStorage.getItem(KEY_CLAIM);
  if(!raw) return null;
  try{ return JSON.parse(raw); }catch(e){ return null; }
}

function clearClaim(){
  localStorage.removeItem(KEY_CLAIM);
  claimBox.style.display = "none";
  claimUntilEl.style.display = "none";
}

function renderClaim(){
  const c = getClaim();
  if(!c){ claimBox.style.display="none"; return; }
  if(c.used){ claimBox.style.display="none"; return; }
  const left = c.expTs - nowMs();
  if(left <= 0){ clearClaim(); return; }

  claimBox.style.display = "block";
  claimCodeEl.textContent = c.code;

  const minLeft = Math.max(0, Math.ceil(left/1000/60));
  claimTimerEl.textContent = "Code valable " + minLeft + " min";

  // Affiche aussi la limite du gain 48h
  const w = getLastWin();
  if(w && w.untilTs){
    claimUntilEl.style.display = "inline-block";
    claimUntilEl.textContent = "Gain valable jusqu'au " + fmtDateTime(w.untilTs);
  } else {
    claimUntilEl.style.display = "none";
  }

  showInfo("Code actif : " + minLeft + " min");
}

/* =========================
   SPIN
   ========================= */
function spin(){
  const lock = getWinLock();
  if(!lock.ok){
    setMsg("üõ°Ô∏è D√©j√† gagn√© r√©cemment.<br><small>Rejouable dans " + fmtWait(lock.waitMin) + ".</small>", "lose");
    showInfo("Bloqu√© jusqu'au " + fmtDateTime(lock.untilTs));
    return;
  }

  const cd = getCooldown();
  if(!cd.ok){
    setMsg("‚è≥ Reviens dans <b>" + cd.wait + "</b> minute(s) pour rejouer üôÇ", "lose");
    showInfo("Rejouable dans " + fmtWait(cd.wait));
    return;
  }

  localStorage.setItem(KEY_LASTPLAY, String(nowMs()));
  showInfo("");
  setMsg("", "");
  claimBox.style.display = "none";
  btn.disabled = true;

  let t = 0;
  const anim = setInterval(()=>{
    r1.textContent = randSymbol();
    r2.textContent = randSymbol();
    r3.textContent = randSymbol();
    t++;
    if(t >= 16){
      clearInterval(anim);
      finish();
    }
  }, 90);
}

function finish(){
  const out = pickOutcome();

  if(out === "PAD"){
    r1.textContent = "7Ô∏è‚É£"; r2.textContent = "7Ô∏è‚É£"; r3.textContent = "7Ô∏è‚É£";
    saveLastWin("PAD");
    setWinLockHours(WIN_LOCK_HOURS);
    const w = getLastWin();
    setMsg("üéâ <b>GAGN√â !</b><br>üçú <b>1 Pad tha√Ø traditionnel nature</b><br><small>Commande minimum <b>30‚Ç¨</b>. Valable jusqu'au <b>" + fmtDateTime(w.untilTs) + "</b>.</small>", "win");
    showInfo("Appuie sur 'R√©clamer au camion' devant nous.");
    claimBox.style.display = "block";
    claimCodeEl.textContent = "BN-------";
    claimTimerEl.textContent = "Code valable 10 minutes";
    claimUntilEl.style.display = "inline-block";
    claimUntilEl.textContent = "Gain valable jusqu'au " + fmtDateTime(w.untilTs);
  } else if(out === "BOX"){
    r1.textContent = "‚≠êÔ∏è"; r2.textContent = "‚≠êÔ∏è"; r3.textContent = "‚≠êÔ∏è";
    saveLastWin("BOX");
    setWinLockHours(WIN_LOCK_HOURS);
    const w = getLastWin();
    setMsg("üéâ <b>GAGN√â !</b><br>üéÅ <b>1 box ap√©ro 8 pi√®ces</b><br><small>Commande minimum <b>30‚Ç¨</b>. Valable jusqu'au <b>" + fmtDateTime(w.untilTs) + "</b>.</small>", "win");
    showInfo("Appuie sur 'R√©clamer au camion' devant nous.");
    claimBox.style.display = "block";
    claimCodeEl.textContent = "BN-------";
    claimTimerEl.textContent = "Code valable 10 minutes";
    claimUntilEl.style.display = "inline-block";
    claimUntilEl.textContent = "Gain valable jusqu'au " + fmtDateTime(w.untilTs);
  } else if(out === "SOFT"){
    r1.textContent = "üçí"; r2.textContent = "üçí"; r3.textContent = "üçí";
    saveLastWin("SOFT");
    setWinLockHours(WIN_LOCK_HOURS);
    const w = getLastWin();
    setMsg("üéâ <b>GAGN√â !</b><br>ü•§ <b>1 boisson soft</b><br><small>Commande minimum <b>30‚Ç¨</b>. Valable jusqu'au <b>" + fmtDateTime(w.untilTs) + "</b>.</small>", "win");
    showInfo("Appuie sur 'R√©clamer au camion' devant nous.");
    claimBox.style.display = "block";
    claimCodeEl.textContent = "BN-------";
    claimTimerEl.textContent = "Code valable 10 minutes";
    claimUntilEl.style.display = "inline-block";
    claimUntilEl.textContent = "Gain valable jusqu'au " + fmtDateTime(w.untilTs);
  } else {
    setMsg("üòÖ Pas gagn√© cette fois‚Ä¶ retente dans 30 minutes !", "lose");
    showInfo("");
    claimBox.style.display = "none";
  }

  btn.disabled = false;
}

/* =========================
   RECLAMER AU CAMION
   ========================= */
function claimNow(){
  if(!winStillValid()){
    alert("Gain expir√© (48h) ou aucun gain enregistr√©.");
    clearClaim();
    return;
  }

  // Reutilise un code si deja actif
  let c = getClaim();
  if(c && !c.used && c.expTs > nowMs()){
    renderClaim();
    return;
  }

  c = createClaim();
  claimBox.style.display = "block";
  claimCodeEl.textContent = c.code;
  renderClaim();
}

/* =========================
   INIT
   ========================= */
(function init(){
  const lock = getWinLock();
  const cd = getCooldown();

  if(!lock.ok){
    setMsg("üõ°Ô∏è D√©j√† gagn√© r√©cemment.<br><small>Bloqu√© jusqu'au " + fmtDateTime(lock.untilTs) + ".</small>", "lose");
    showInfo("Bloqu√© jusqu'au " + fmtDateTime(lock.untilTs));
  } else if(!cd.ok){
    showInfo("Rejouable dans " + fmtWait(cd.wait));
  }

  renderClaim();
  setInterval(renderClaim, 15000);
})();
</script>

</body>
</html>
