<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>La Bo√Æte √† Nems ‚Äì Jeu</title>
  <style>
    body{
      font-family: Arial, sans-serif;
      background:#111; color:#fff; margin:0; padding:24px 12px;
      text-align:center;
    }
    h1{ margin:10px 0 6px; letter-spacing:1px; }
    .sub{ opacity:.9; margin:0 0 18px; }
    .card{
      max-width:560px; margin:0 auto; padding:18px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius:14px;
      box-shadow: 0 10px 25px rgba(0,0,0,.35);
    }
    .reels{ display:flex; gap:14px; justify-content:center; margin:10px 0 14px; }
    .reel{
      width:86px; height:86px;
      display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.18);
      border-radius:14px;
      font-size:44px;
      user-select:none;
    }
    .btn{
      display:inline-block; border:0; cursor:pointer;
      padding:12px 18px; border-radius:10px;
      font-size:18px; font-weight:700;
    }
    .spin{ background:#f5c400; color:#111; min-width:140px; }
    .spin:disabled{ opacity:.55; cursor:not-allowed; }
    .rowbtns{ display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-top:14px;}
    .linkbtn{
      background:#eee; color:#111; text-decoration:none;
      padding:12px 14px; border-radius:10px; font-weight:700;
      min-width:220px;
    }
    .green{ background:#28c76f; color:#081b10; }
    .msg{ margin:14px 0 0; font-size:18px; font-weight:700; }
    .msg.ok{ color:#66ff9a; }
    .msg.no{ color:#ff6a6a; }
    .small{ font-size:13px; opacity:.9; margin-top:10px; line-height:1.35; text-align:left; }
    .legend{ margin-top:14px; text-align:left; font-size:14px; }
    .hr{ height:1px; background:rgba(255,255,255,.12); margin:12px 0; }
    .claimBox{
      margin-top:12px; padding:10px 12px; border-radius:12px;
      background:rgba(0,0,0,.35);
      border:1px dashed rgba(255,255,255,.25);
      text-align:left;
      display:none;
    }
    .code{
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      font-size:18px; font-weight:900; letter-spacing:1px;
      padding:8px 10px; background:rgba(255,255,255,.08);
      border-radius:10px; display:inline-block;
    }
    .tiny{ font-size:12px; opacity:.85; }
  </style>
</head>

<body>
  <h1>üé∞ LA BO√éTE √Ä NEMS üé∞</h1>
  <div class="sub">Joue pour le fun‚Ä¶ et parfois un cadeau üòã</div>

  <div class="card">
    <div class="reels">
      <div class="reel" id="reel1">üçí</div>
      <div class="reel" id="reel2">‚≠ê</div>
      <div class="reel" id="reel3">7Ô∏è‚É£</div>
    </div>

    <button class="btn spin" id="spinBtn" onclick="spin()">SPIN</button>

    <div id="msg" class="msg"></div>

    <div class="rowbtns">
      <a class="linkbtn" href="https://la-boite-a-nems-le-muy.eatbu.com" target="_blank" rel="noopener">D√©couvrir La Bo√Æte √† Nems</a>
      <a class="linkbtn green" href="tel:+33782549660">Commander (t√©l√©phone)</a>
      <a class="linkbtn green" href="https://wa.me/33782549660" target="_blank" rel="noopener">Commander (WhatsApp)</a>
    </div>

    <div class="legend">
      <div><b>L√©gende des gains</b></div>
      <div>üçíüçíüçí = 1 boisson soft</div>
      <div>‚≠ê‚≠ê‚≠ê = 1 box ap√©ro 8 pi√®ces</div>
      <div>7Ô∏è‚É£7Ô∏è‚É£7Ô∏è‚É£ = 1 Pad tha√Ø traditionnel nature</div>
    </div>

    <div class="hr"></div>

    <div class="small">
      üßæ Commande minimum : <b>30‚Ç¨</b>.<br>
      üéÅ Cadeau remis uniquement lors d‚Äôune commande (selon disponibilit√©).<br>
      ‚è≥ Gain valable <b>48h</b> √† compter du gain.<br>
      ‚õî Si tu gagnes : tu ne peux plus rejouer pendant <b>24h</b> sur ce t√©l√©phone.<br>
      üîê Un code de r√©clamation est g√©n√©r√© (valable <b>10 min</b>) pour limiter les profiteurs.
    </div>

    <div id="claimBox" class="claimBox">
      <div><b>üéÅ Code de r√©clamation</b></div>
      <div class="code" id="claimCode">----</div>
      <div class="tiny" id="claimInfo"></div>
    </div>
  </div>

<script>
  // ===== R√©glages =====
  // Probabilit√©s de gain :
  // Soft (üçíüçíüçí) : 1 sur 5
  // Box (‚≠ê‚≠ê‚≠ê) : 1 sur 8
  // Pad (7Ô∏è‚É£7Ô∏è‚É£7Ô∏è‚É£) : 1 sur 20
  // Le pad est donc tr√®s rare.
  const PHONE_LOCK_HOURS_AFTER_WIN = 24;
  const GAIN_VALID_HOURS = 48;
  const CLAIM_CODE_VALID_MIN = 10;
  const MIN_ORDER_EUR = 30;

  // ===== Symboles =====
  const CHERRY = "üçí";
  const STAR   = "‚≠ê";
  const SEVEN  = "7Ô∏è‚É£";
  const SYMBOLS = [CHERRY, STAR, SEVEN, "üçã", "üîî"]; // extras juste pour le visuel

  const reels = [
    document.getElementById("reel1"),
    document.getElementById("reel2"),
    document.getElementById("reel3")
  ];
  const spinBtn  = document.getElementById("spinBtn");
  const msgEl    = document.getElementById("msg");
  const claimBox = document.getElementById("claimBox");
  const claimCodeEl = document.getElementById("claimCode");
  const claimInfoEl = document.getElementById("claimInfo");

  function nowMs(){ return Date.now(); }

  function setMsg(text, kind){
    msgEl.textContent = text;
    msgEl.className = "msg " + (kind || "");
  }

  function lockUntilKey(){ return "lbn_lock_until"; }
  function winInfoKey(){ return "lbn_win_info"; }

  function getLockUntil(){
    const v = localStorage.getItem(lockUntilKey());
    return v ? parseInt(v, 10) : 0;
  }
  function setLockHours(h){
    const until = nowMs() + h*60*60*1000;
    localStorage.setItem(lockUntilKey(), String(until));
  }

  function randInt(n){ return Math.floor(Math.random()*n); }

  // Choisit un gain selon les proba demand√©es
  function pickWinType(){
    // On teste le plus rare d'abord pour √©viter qu'il soit ‚Äúmang√©‚Äù par les autres
    if (randInt(20) === 0) return "PAD";   // 1/20
    if (randInt(üòé  === 0) return "BOX";   // 1/8
    if (randInt(5)  === 0) return "SOFT";  // 1/5
    return null; // perdu
  }

  function makeClaimCode(){
    // code court, facile √† lire au camion
    // ex : NEMS-7K3F9Q
    const chars = "ABCDEFGHJKMNPQRSTUVWXYZ23456789";
    let s = "";
    for (let i=0;i<6;i++) s += chars[randInt(chars.length)];
    return "NEMS-" + s;
  }

  function showClaim(code, createdAt){
    const expiresAt = createdAt + CLAIM_CODE_VALID_MIN*60*1000;
    const mins = CLAIM_CODE_VALID_MIN;
    claimCodeEl.textContent = code;
    claimInfoEl.textContent = "Valable " + mins + " min. Montre ce code au camion au moment du retrait.";
    claimBox.style.display = "block";

    // auto-masquage si expir√©
    const t = setInterval(() => {
      if (nowMs() > expiresAt){
        clearInterval(t);
        claimBox.style.display = "none";
      }
    }, 1000);
  }

  function saveWinInfo(type){
    const createdAt = nowMs();
    const info = {
      type,
      createdAt,
      validUntil: createdAt + GAIN_VALID_HOURS*60*60*1000,
      claimCode: makeClaimCode(),
      claimUntil: createdAt + CLAIM_CODE_VALID_MIN*60*1000
    };
    localStorage.setItem(winInfoKey(), JSON.stringify(info));
    return info;
  }

  function clearClaim(){
    claimBox.style.display = "none";
    localStorage.removeItem(winInfoKey());
  }

  function maybeShowExistingWin(){
    const raw = localStorage.getItem(winInfoKey());
    if (!raw) return;
    try{
      const info = JSON.parse(raw);
      if (nowMs() > info.validUntil){
        clearClaim();
        return;
      }
      // montre uniquement si le code est encore valide (10 min)
      if (nowMs() <= info.claimUntil){
        showClaim(info.claimCode, info.createdAt);
      } else {
        claimBox.style.display = "none";
      }
    }catch(e){
      clearClaim();
    }
  }

  // ===== ANIMATION ‚Äú√ßa tourne‚Äù =====
  function animateReels(durationMs, intervalMs){
    return new Promise(resolve => {
      const start = nowMs();
      const timer = setInterval(() => {
        reels[0].textContent = SYMBOLS[randInt(SYMBOLS.length)];
        reels[1].textContent = SYMBOLS[randInt(SYMBOLS.length)];
        reels[2].textContent = SYMBOLS[randInt(SYMBOLS.length)];
        if (nowMs() - start >= durationMs){
          clearInterval(timer);
          resolve();
        }
      }, intervalMs);
    });
  }

  // Met le r√©sultat final (3 m√™mes si gain, sinon pas pareil)
  function setFinalSymbols(winType){
    if (winType === "SOFT"){
      reels.forEach(r => r.textContent = CHERRY);
    } else if (winType === "BOX"){
      reels.forEach(r => r.textContent = STAR);
    } else if (winType === "PAD"){
      reels.forEach(r => r.textContent = SEVEN);
    } else {
      // perdu : 3 symboles non identiques (autant que possible)
      const a = SYMBOLS[randInt(SYMBOLS.length)];
      let b = SYMBOLS[randInt(SYMBOLS.length)];
      let c = SYMBOLS[randInt(SYMBOLS.length)];
      // √©vite au max les triples
      if (b === a) b = STAR;
      if (c === a || c === b) c = SEVEN;
      reels[0].textContent = a;
      reels[1].textContent = b;
      reels[2].textContent = c;
    }
  }

  async function spin(){
    // blocage si gagn√© r√©cemment
    const lockUntil = getLockUntil();
    if (nowMs() < lockUntil){
      const minsLeft = Math.ceil((lockUntil - nowMs())/60000);
      setMsg("‚õî D√©j√† gagnant r√©cemment. Reviens dans " + minsLeft + " min.", "no");
      return;
    }

    // reset messages
    setMsg("", "");
    claimBox.style.display = "none";

    spinBtn.disabled = true;

    // animation
    await animateReels(900, 70);

    // r√©sultat
    const winType = pickWinType();
    setFinalSymbols(winType);

    if (!winType){
      setMsg("üòã Pas gagn√© cette fois‚Ä¶ retente quand tu veux !", "no");
      spinBtn.disabled = false;
      return;
    }

    // gagn√© : lock 24h sur ce tel + cr√©e code de r√©clamation 10 min + affiche
    setLockHours(PHONE_LOCK_HOURS_AFTER_WIN);
    const info = saveWinInfo(winType);

    if (winType === "SOFT"){
      setMsg("üéâ GAGN√â ! 1 boisson soft (commande min " + MIN_ORDER_EUR + "‚Ç¨)", "ok");
    } else if (winType === "BOX"){
      setMsg("üéâ GAGN√â ! 1 box ap√©ro 8 pi√®ces (commande min " + MIN_ORDER_EUR + "‚Ç¨)", "ok");
    } else {
      setMsg("üéâ GAGN√â ! 1 Pad tha√Ø nature (commande min " + MIN_ORDER_EUR + "‚Ç¨)", "ok");
    }

    showClaim(info.claimCode, info.createdAt);
    spinBtn.disabled = false;
  }

  // Au chargement : si un gain encore valable existe, on peut afficher le code s'il est encore dans les 10 min
  maybeShowExistingWin();
</script>
</body>
</html>
