<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üé∞ La Bo√Æte √† Nems ‚Äî Jeu</title>

  <style>
    :root{
      --bg:#111;
      --card:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.12);
      --txt:#fff;
      --muted:rgba(255,255,255,.78);
      --warn:#ff5a5a;
      --ok:#4ee07a;
      --btn:#f2f2f2;
      --btn2:#2ecc71;
      --shadow:0 16px 50px rgba(0,0,0,.55);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px 12px;
      background:var(--bg);
      color:var(--txt);
      font-family:Arial, sans-serif;
      text-align:center;
    }
    .wrap{width:min(700px, 100%)}
    h1{
      margin:0 0 8px 0;
      letter-spacing:.04em;
      font-size:clamp(26px, 4vw, 40px);
      text-transform:uppercase;
    }
    .sub{
      margin:0 0 16px 0;
      color:var(--muted);
      font-size:clamp(14px, 2.2vw, 18px);
    }
    .card{
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:16px;
      padding:18px 14px;
      box-shadow:var(--shadow);
      backdrop-filter: blur(6px);
    }

    .reels{
      display:flex;
      justify-content:center;
      gap:16px;
      margin:14px 0 12px 0;
      user-select:none;
    }
    .reel{
      width:92px;
      height:92px;
      border-radius:18px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.25);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:54px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
    }

    .spinRow{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:10px;
      margin:8px 0 10px 0;
    }
    .spinBtn{
      appearance:none;
      border:0;
      cursor:pointer;
      padding:12px 22px;
      border-radius:12px;
      font-size:18px;
      font-weight:700;
      background: #f7c948;
      color:#222;
      box-shadow: 0 10px 26px rgba(0,0,0,.35);
    }
    .spinBtn:disabled{
      opacity:.55;
      cursor:not-allowed;
    }

    .msg{
      margin:6px 0 0 0;
      min-height:48px;
      font-size:clamp(15px, 2.4vw, 18px);
      font-weight:700;
    }
    .msg.ok{color:var(--ok)}
    .msg.warn{color:var(--warn)}
    .tiny{
      margin-top:10px;
      color:rgba(255,255,255,.78);
      font-size:13px;
      line-height:1.35;
    }

    .actions{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:14px;
    }
    .btn{
      display:inline-block;
      padding:12px 16px;
      border-radius:12px;
      text-decoration:none;
      font-weight:700;
      border:1px solid rgba(255,255,255,.18);
      background:var(--btn);
      color:#222;
      min-width:220px;
    }
    .btn.green{
      background:var(--btn2);
      color:#0b2b15;
      border-color: rgba(0,0,0,.08);
    }

    .legend{
      margin-top:14px;
      text-align:left;
      display:inline-block;
      width:min(520px, 100%);
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.18);
      font-size:14px;
      line-height:1.45;
    }
    .legend b{color:#fff}
    .hr{
      height:1px;
      background:rgba(255,255,255,.12);
      margin:10px 0;
    }

    .claimBox{
      margin-top:12px;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid rgba(78,224,122,.35);
      background:rgba(78,224,122,.10);
      display:none;
      text-align:left;
      width:min(520px, 100%);
    }
    .claimBox strong{display:block;margin-bottom:6px}
    .codeLine{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size:18px;
      letter-spacing:.08em;
      margin:6px 0 10px 0;
    }
    .claimBtn{
      appearance:none;border:0;cursor:pointer;
      padding:10px 14px;border-radius:12px;
      font-weight:800;background:#ffffff;color:#111;
      border:1px solid rgba(0,0,0,.1);
    }

    @media (max-width:420px){
      .reel{width:78px;height:78px;font-size:48px}
      .btn{min-width:170px}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>üé∞ LA BO√éTE √Ä NEMS üé∞</h1>
    <p class="sub">Joue pour le fun‚Ä¶ et parfois un cadeau üòÑ</p>

    <div class="card">
      <div class="reels" aria-label="Machine √† sous">
        <div class="reel" id="r1">üçí</div>
        <div class="reel" id="r2">‚≠ê</div>
        <div class="reel" id="r3">7Ô∏è‚É£</div>
      </div>

      <div class="spinRow">
        <button class="spinBtn" id="spinBtn" onclick="spin()">SPIN</button>
        <div class="msg" id="msg"></div>
      </div>

      <div class="actions">
        <a class="btn" id="discoverBtn" href="https://la-boite-a-nems-le-muy.eatbu.com" target="_blank" rel="noopener">
          D√©couvrir La Bo√Æte √† Nems
        </a>
        <a class="btn green" id="orderBtn" href="tel:+33782549660">
          Commander (t√©l√©phone)
        </a>
        <a class="btn green" id="waBtn" href="https://wa.me/33782549660?text=Bonjour%20La%20Bo%C3%AEte%20%C3%A0%20Nems%20!%20Je%20veux%20passer%20une%20commande%20%F0%9F%98%8A" target="_blank" rel="noopener">
          Commander (WhatsApp)
        </a>
      </div>

      <div class="claimBox" id="claimBox">
        <strong>üéÅ R√©clamation au camion</strong>
        <div>Montre ce code (√©cran ou capture) :</div>
        <div class="codeLine" id="claimCode">‚Äî</div>
        <div>Valable jusqu‚Äô√† : <b id="claimUntil">‚Äî</b> (10 min)</div>
        <div class="tiny">Astuce : si tu commandes par t√©l√©phone/WhatsApp, envoie la capture de ce code.</div>
      </div>

      <div class="legend">
        <b>L√©gende des gains</b><br>
        üçíüçíüçí = 1 boisson soft<br>
        ‚≠ê‚≠ê‚≠ê = 1 box ap√©ro 8 pi√®ces<br>
        7Ô∏è‚É£7Ô∏è‚É£7Ô∏è‚É£ = 1 Pad tha√Ø traditionnel nature
        <div class="hr"></div>
        ‚è≥ Si tu gagnes : tu ne peux plus rejouer pendant <b>24h</b> sur ce t√©l√©phone.<br>
        üí∂ Commande minimum : <b>30‚Ç¨</b>.<br>
        üßæ Cadeau remis uniquement lors d‚Äôune commande (selon disponibilit√©).<br>
        ‚è±Ô∏è Gain valable <b>48h</b> √† compter du gain.<br>
        üé´ Code de r√©clamation g√©n√©r√© (valable <b>10 min</b>) pour limiter les profiteurs.
      </div>

      <p class="tiny">
        ‚ö†Ô∏è Sans serveur, le blocage 24h est bas√© sur le t√©l√©phone (localStorage).<br>
        Si quelqu‚Äôun efface ses donn√©es navigateur, il peut tricher. Pour bloquer √† 100%, il faut un syst√®me serveur.
      </p>
    </div>
  </div>

  <script>
    /***********************
     * R√âGLAGES (TOI TU CHANGES ICI)
     ***********************/
    const SITE_URL = "https://la-boite-a-nems-le-muy.eatbu.com";
    const TEL = "+33782549660";

    // Probabilit√©s (gain ind√©pendant de l'animation)
    // Boisson : 1/5 ; Box : 1/8 ; Pad : 1/20 (tr√®s rare)
    const PROBA_SOFT = 5;
    const PROBA_BOX  = 8;
    const PROBA_PAD  = 20;

    // Anti-profiteurs
    const LOCK_HOURS_AFTER_WIN = 24;     // stop jeu 24h si gain
    const CLAIM_CODE_MINUTES = 10;       // code r√©clamation valable 10 min
    const GAIN_VALID_HOURS = 48;         // gain valable 48h

    /***********************
     * SYMBOLES
     ***********************/
    const SYM_CHERRY = "üçí";
    const SYM_STAR   = "‚≠ê";
    const SYM_SEVEN  = "7Ô∏è‚É£";

    const SYMBOLS = [SYM_CHERRY, SYM_STAR, SYM_SEVEN];

    // Clefs stockage
    const K_LAST_WIN_TS = "lb_nems_last_win_ts";
    const K_LAST_GAIN   = "lb_nems_last_gain";
    const K_CLAIM_CODE  = "lb_nems_claim_code";
    const K_CLAIM_UNTIL = "lb_nems_claim_until";

    const el = (id) => document.getElementById(id);

    // Liens
    el("discoverBtn").href = SITE_URL;

    /***********************
     * UTILITAIRES
     ***********************/
    function nowMs(){ return Date.now(); }

    function formatTime(ts){
      const d = new Date(ts);
      const hh = String(d.getHours()).padStart(2,"0");
      const mm = String(d.getMinutes()).padStart(2,"0");
      return ${hh}:${mm};
    }

    function hoursToMs(h){ return h * 60 * 60 * 1000; }
    function minsToMs(m){ return m * 60 * 1000; }

    function setMsg(text, type){
      const m = el("msg");
      m.className = "msg" + (type ? (" " + type) : "");
      m.textContent = text;
    }

    function setReels(a,b,c){
      el("r1").textContent = a;
      el("r2").textContent = b;
      el("r3").textContent = c;
    }

    function randomSymbol(){
      return SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
    }

    // Eviter de tomber sur un triple gagnant quand c'est "perdu"
    function randomNonWinningTriplet(){
      while(true){
        const a = randomSymbol();
        const b = randomSymbol();
        const c = randomSymbol();
        const triple = (a === b && b === c);
        if(!triple) return [a,b,c];
        // si triple, on relance (√ßa arrive peu)
      }
    }

    function isLocked(){
      const lastWin = Number(localStorage.getItem(K_LAST_WIN_TS) || 0);
      if(!lastWin) return false;
      return (nowMs() - lastWin) < hoursToMs(LOCK_HOURS_AFTER_WIN);
    }

    function lockRemaining(){
      const lastWin = Number(localStorage.getItem(K_LAST_WIN_TS) || 0);
      const end = lastWin + hoursToMs(LOCK_HOURS_AFTER_WIN);
      const ms = Math.max(0, end - nowMs());
      const h = Math.floor(ms / 3600000);
      const m = Math.floor((ms % 3600000) / 60000);
      if(h <= 0) return ${m} min;
      return ${h}h${String(m).padStart(2,"0")};
    }

    function generateClaimCode(){
      // simple + lisible (6 chiffres)
      const n = Math.floor(100000 + Math.random() * 900000);
      return String(n);
    }

    function showClaimBox(code, untilTs){
      el("claimBox").style.display = "block";
      el("claimCode").textContent = code;
      el("claimUntil").textContent = formatTime(untilTs);
    }

    function hideClaimBox(){
      el("claimBox").style.display = "none";
    }

    /***********************
     * SPIN
     ***********************/
    let spinning = false;
    let spinTimer = null;

    function animateSpin(durationMs){
      const start = nowMs();
      return new Promise((resolve) => {
        spinTimer = setInterval(() => {
          setReels(randomSymbol(), randomSymbol(), randomSymbol());
          if(nowMs() - start >= durationMs){
            clearInterval(spinTimer);
            spinTimer = null;
            resolve();
          }
        }, 70);
      });
    }

    function decideOutcome(){
      // IMPORTANT : ordre du plus rare au plus fr√©quent
      if (Math.floor(Math.random() * PROBA_PAD) === 0)  return "PAD";   // 1/20
      if (Math.floor(Math.random() * PROBA_BOX) === 0)  return "BOX";   // 1/8
      if (Math.floor(Math.random() * PROBA_SOFT) === 0) return "SOFT";  // 1/5
      return null; // perdu
    }

    function spin(){
      if(spinning) return;

      // blocage apr√®s gain 24h
      if(isLocked()){
        setMsg(‚õî Tu as d√©j√† gagn√© r√©cemment. Reviens dans ${lockRemaining()} üôÇ, "warn");
        return;
      }

      spinning = true;
      el("spinBtn").disabled = true;
      hideClaimBox();
      setMsg("üé∞ √áa tourne‚Ä¶", "");

      animateSpin(950).then(() => {
        const outcome = decideOutcome();

        if(outcome === "SOFT"){
          setReels(SYM_CHERRY, SYM_CHERRY, SYM_CHERRY);
          win("üçíüçíüçí", "1 boisson soft");
        } else if(outcome === "BOX"){
          setReels(SYM_STAR, SYM_STAR, SYM_STAR);
          win("‚≠ê‚≠ê‚≠ê", "1 box ap√©ro 8 pi√®ces");
        } else if(outcome === "PAD"){
          setReels(SYM_SEVEN, SYM_SEVEN, SYM_SEVEN);
          win("7Ô∏è‚É£7Ô∏è‚É£7Ô∏è‚É£", "1 Pad tha√Ø traditionnel nature");
        } else {
          const [a,b,c] = randomNonWinningTriplet();
          setReels(a,b,c);
          setMsg("üòÖ Pas gagn√© cette fois‚Ä¶ retente quand tu veux !", "warn");
        }

        spinning = false;
        el("spinBtn").disabled = false;
      });
    }

    function win(combo, label){
      // Enregistrer gain + bloquer 24h
      localStorage.setItem(K_LAST_WIN_TS, String(nowMs()));
      localStorage.setItem(K_LAST_GAIN, label);

      // Code r√©clamation valable 10 min
      const code = generateClaimCode();
      const untilTs = nowMs() + minsToMs(CLAIM_CODE_MINUTES);
      localStorage.setItem(K_CLAIM_CODE, code);
      localStorage.setItem(K_CLAIM_UNTIL, String(untilTs));

      setMsgüéâ GAGN√â ! ${label} (${combo})`, "ok");

      // Afficher code + validit√© (et rappeler les 48h)
      showClaimBox(code, untilTs);

      // Petit rappel en plus (48h) directement dans le message secondaire
      const gainUntil = nowMs() + hoursToMs(GAIN_VALID_HOURS);
      const txt =üéâ GAGN√â ! ${label} ‚Äî valable 48h (jusqu‚Äôau ${new Date(gainUntil).toLocaleString("fr-FR")}).`;
      // On garde le msg court + box pour le code
      // (si tu veux, je peux mettre ce d√©tail directement sous le bouton)
    }

    /***********************
     * Au chargement : si un code existe encore valide, on le r√©-affiche
     ***********************/
    (function init(){
      const code = localStorage.getItem(K_CLAIM_CODE);
      const until = Number(localStorage.getItem(K_CLAIM_UNTIL) || 0);
      const gain = localStorage.getItem(K_LAST_GAIN);

      if(code && until && nowMs() < until){
        // Si la personne a gagn√© r√©cemment et revient, on lui r√©-affiche le code encore valide
        showClaimBox(code, until);
        if(gain){
          setMsgüéâ Tu as gagn√© : ${gain}. Montre le code ci-dessous au camion.`, "ok");
        }
      } else {
        // si expir√©, on nettoie
        localStorage.removeItem(K_CLAIM_CODE);
        localStorage.removeItem(K_CLAIM_UNTIL);
      }

      // Met √† jour les liens commande (au cas o√π)
      el("orderBtn").href = tel:${TEL};
      el("waBtn").href = https://wa.me/${TEL.replace("+","")}?text=${encodeURIComponent("Bonjour La Bo√Æte √† Nems ! Je veux passer une commande üòä")};
    })();
  </script>
</body>
</html>
